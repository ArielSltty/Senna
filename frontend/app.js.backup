// frontend/app.js - PRODUCTION READY
// âš¡ JavaScript Frontend Logic for Senna Wallet with View Management & API Integration

class SennaWallet {
    constructor() {
        this.apiBaseUrl = 'http://localhost:8000';
        this.currentWallet = null;
        this.provider = null;
        this.chatHistory = [];
        this.isConnected = false;
        this.currentView = 'landing';
        
        // Somnia Network configuration
        this.somniaNetwork = {
            chainId: '0xC498', // 50312 in hex
            chainName: 'Somnia Testnet',
            rpcUrls: ['https://dream-rpc.somnia.network/'],
            blockExplorerUrls: ['https://shannon-explorer.somnia.network/'],
            nativeCurrency: {
                name: 'Somnia Test Token',
                symbol: 'STT',
                decimals: 18
            }
        };
        
        // Initialize the application
        this.init();
    }

    init() {
        this.bindEvents();
        this.initializeProvider();
        this.loadWalletFromStorage();
        this.updateMarketData();
        this.setupAutoRefresh();
        this.initializeViewManager();
        
        console.log('ðŸ§  Senna Wallet initialized - PRODUCTION READY');
    }

    // ===== VIEW MANAGEMENT =====
    initializeViewManager() {
        // Handle URL routing
        this.handleUrlRouting();
        
        // Show initial view
        this.showView(this.currentView);
    }

    handleUrlRouting() {
        const urlParams = new URLSearchParams(window.location.search);
        const page = urlParams.get('page');
        
        if (page === 'chat') {
            this.showView('chat');
        } else {
            this.showView('landing');
        }
    }

    showView(viewName) {
        // Hide all views
        document.querySelectorAll('.view').forEach(view => {
            view.classList.remove('active');
        });
        
        // Show selected view
        const targetView = document.getElementById(`${viewName}View`);
        if (targetView) {
            targetView.classList.add('active');
            this.currentView = viewName;
            
            // Update URL without page reload
            const newUrl = viewName === 'landing' 
                ? window.location.pathname 
                : `${window.location.pathname}?page=${viewName}`;
            window.history.pushState({}, '', newUrl);
            
            // Initialize view-specific functionality
            this.initializeView(viewName);
        }
    }

    initializeView(viewName) {
        switch(viewName) {
            case 'chat':
                this.initializeChatView();
                break;
            case 'landing':
                this.initializeLandingView();
                break;
        }
    }

    initializeChatView() {
        // Initialize chat-specific functionality
        this.setupChatAutoResize();
        this.loadChatHistory();
        this.updateChatWalletInfo();
    }

    initializeLandingView() {
        // Initialize landing page functionality
        this.updateLandingWalletInfo();
    }

    navigateToChat() {
        this.showView('chat');
    }

    navigateToLanding() {
        this.showView('landing');
    }

    // ===== WALLET CONNECTION =====
    async initializeProvider() {
        try {
            // Initialize ethers provider
            this.provider = new ethers.providers.JsonRpcProvider(this.somniaNetwork.rpcUrls[0]);
            
            // Check connection
            const network = await this.provider.getNetwork();
            console.log('ðŸ”— Connected to network:', network);
            
            // Update network status
            this.updateNetworkStatus(true);
            
        } catch (error) {
            console.error('âŒ Failed to initialize provider:', error);
            this.updateNetworkStatus(false);
        }
    }

    bindEvents() {
        // View navigation
        document.getElementById('heroConnectBtn')?.addEventListener('click', () => this.navigateToChat());
        document.getElementById('navConnectBtn')?.addEventListener('click', () => this.navigateToChat());
        document.getElementById('ctaConnectBtn')?.addEventListener('click', () => this.navigateToChat());
        document.getElementById('backToLandingBtn')?.addEventListener('click', () => this.navigateToLanding());
        
        // Router navigation
        document.querySelectorAll('.router-nav-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const page = e.target.dataset.page;
                this.showView(page);
            });
        });

        // Chat functionality
        document.getElementById('sendMessageBtn')?.addEventListener('click', () => this.sendMessage());
        document.getElementById('chatInput')?.addEventListener('keypress', (e) => this.handleChatInputKeypress(e));
        document.getElementById('clearChatBtn')?.addEventListener('click', () => this.clearChat());
        document.getElementById('helpBtn')?.addEventListener('click', () => this.showHelp());

        // Wallet management
        document.getElementById('connectWalletBtn')?.addEventListener('click', () => this.connectWallet());
        document.getElementById('createWalletBtn')?.addEventListener('click', () => this.createWallet());
        document.getElementById('exportWalletBtn')?.addEventListener('click', () => this.exportWallet());
        document.getElementById('viewOnExplorerBtn')?.addEventListener('click', () => this.viewOnExplorer());
        document.getElementById('gasPriceBtn')?.addEventListener('click', () => this.checkGasPrice());
        document.getElementById('disconnectBtn')?.addEventListener('click', () => this.disconnectWallet());

        // Quick actions
        document.querySelectorAll('.quick-action-btn, .quick-action-pill').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const action = e.currentTarget.dataset.action;
                this.quickAction(action);
            });
        });

        // Modal management
        document.getElementById('closeWalletModal')?.addEventListener('click', () => this.hideModal('walletModal'));
        document.getElementById('closeTransactionModal')?.addEventListener('click', () => this.hideModal('transactionModal'));
        document.getElementById('copyWalletData')?.addEventListener('click', () => this.copyWalletData());
        document.getElementById('downloadWalletData')?.addEventListener('click', () => this.downloadWalletData());
        document.getElementById('cancelTransaction')?.addEventListener('click', () => this.hideModal('transactionModal'));
        document.getElementById('confirmTransaction')?.addEventListener('click', () => this.confirmTransaction());

        // Close modals on outside click
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('show');
            }
        });

        // Retry button for error screen
        document.getElementById('retryButton')?.addEventListener('click', () => this.retryInitialization());
    }

    // ===== CHAT FUNCTIONALITY =====
    async sendMessage() {
        const input = document.getElementById('chatInput');
        const message = input.value.trim();
        
        if (!message) return;

        // Add user message to chat
        this.addMessageToChat('user', message);
        input.value = '';
        this.resizeTextarea();

        // Show typing indicator
        this.showTypingIndicator();

        try {
            const response = await this.apiCall('/api/chat', 'POST', {
                message: message,
                wallet_address: this.currentWallet?.address,
                session_id: this.getSessionId()
            });

            // Hide typing indicator
            this.hideTypingIndicator();

            // Add AI response to chat
            this.addMessageToChat('ai', response.response, response);

            // Handle specific actions
            if (response.action === 'send_transaction' && response.transaction_data) {
                this.showTransactionModal(response.transaction_data);
            }

            // Update wallet info if balance was checked
            if (response.action === 'get_balance' && response.data) {
                this.updateWalletDisplay(response.data);
            }

            // Save chat history
            this.saveChatHistory();

        } catch (error) {
            this.hideTypingIndicator();
            this.addMessageToChat('ai', `Sorry, I encountered an error: ${error.message}`);
            this.showNotification('Error', error.message, 'error');
        }
    }

    handleChatInputKeypress(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            this.sendMessage();
        }
    }

    addMessageToChat(sender, message, data = null) {
        const chatMessages = document.getElementById('chatMessages');
        if (!chatMessages) return;

        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${sender}-message`;

        const avatar = document.createElement('div');
        avatar.className = 'message-avatar';
        avatar.innerHTML = `<img src="assets/logo.png" alt="${sender === 'user' ? 'User' : 'AI'}" class="avatar-img">`;

        const contentDiv = document.createElement('div');
        contentDiv.className = 'message-content';

        const bubble = document.createElement('div');
        bubble.className = 'message-bubble';
        
        // Format message with proper line breaks
        const formattedMessage = message.replace(/\n/g, '<br>');
        bubble.innerHTML = formattedMessage;

        // Add transaction data if available
        if (data && data.transaction_data) {
            const txData = document.createElement('div');
            txData.className = 'transaction-data';
            txData.innerHTML = `
                <div style="margin-top: 10px; padding: 10px; background: var(--bg-card); border-radius: 8px;">
                    <strong>Transaction Details:</strong><br>
                    Amount: ${data.transaction_data.amount} ${data.transaction_data.symbol}<br>
                    To: ${this.shortenAddress(data.transaction_data.to_address)}
                </div>
            `;
            bubble.appendChild(txData);
        }

        // Add balance display if available
        if (data && data.balance_data) {
            const balanceDisplay = document.createElement('div');
            balanceDisplay.className = 'balance-display';
            balanceDisplay.innerHTML = this.formatBalanceData(data.balance_data);
            bubble.appendChild(balanceDisplay);
        }

        const time = document.createElement('div');
        time.className = 'message-time';
        time.textContent = new Date().toLocaleTimeString();

        contentDiv.appendChild(bubble);
        contentDiv.appendChild(time);

        if (sender === 'ai') {
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentDiv);
        } else {
            messageDiv.appendChild(contentDiv);
            messageDiv.appendChild(avatar);
        }

        chatMessages.appendChild(messageDiv);
        this.scrollToBottom();

        // Store in history
        this.chatHistory.push({ 
            sender, 
            message, 
            data,
            timestamp: new Date().toISOString() 
        });
    }

    formatBalanceData(balanceData) {
        return `
            <div class="token-balance">
                <span class="token-amount">${parseFloat(balanceData.balance).toFixed(4)}</span>
                <span class="token-symbol">${balanceData.symbol}</span>
                <span class="token-value">($${(parseFloat(balanceData.balance) * 0.15).toFixed(2)})</span>
            </div>
        `;
    }

    scrollToBottom() {
        const chatMessages = document.getElementById('chatMessages');
        if (chatMessages) {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    }

    showTypingIndicator() {
        const indicator = document.getElementById('typingIndicator');
        if (indicator) {
            indicator.style.display = 'flex';
            this.scrollToBottom();
        }
    }

    hideTypingIndicator() {
        const indicator = document.getElementById('typingIndicator');
        if (indicator) {
            indicator.style.display = 'none';
        }
    }

    clearChat() {
        const chatMessages = document.getElementById('chatMessages');
        if (chatMessages) {
            chatMessages.innerHTML = '';
            this.chatHistory = [];
            this.saveChatHistory();
            
            // Add welcome message back
            this.addMessageToChat('ai', `
                <h4>ðŸ¤– Welcome to Senna Wallet!</h4>
                <p>I'm your AI-powered wallet assistant for Somnia Blockchain. You can talk to me naturally to manage your crypto!</p>
                <div class="quick-examples">
                    <p><strong>Try saying:</strong></p>
                    <ul>
                        <li>"Show my balance"</li>
                        <li>"Send 10 STT to 0x..."</li>
                        <li>"What's the SOMI price today?"</li>
                        <li>"Create a new wallet for me"</li>
                        <li>"I want to buy 100 USD worth of SOMI"</li>
                    </ul>
                </div>
                <p>Just type what you want to do below! ðŸ‘‡</p>
            `);
        }
    }

    showHelp() {
        this.addMessageToChat('ai', `
            <h4>ðŸ¤– Senna Wallet Help Guide</h4>
            <p>Here's what I can help you with:</p>
            <ul>
                <li><strong>Check Balance</strong>: "Show my balance", "How much do I have?"</li>
                <li><strong>Send Crypto</strong>: "Send 10 SOMI to 0x...", "Transfer 5 STT"</li>
                <li><strong>Create Wallet</strong>: "Create new wallet for me"</li>
                <li><strong>Check Price</strong>: "What's SOMI price today?", "Current STT value"</li>
                <li><strong>Buy Crypto</strong>: "I want to buy 100 USD worth of SOMI"</li>
                <li><strong>Compare Exchanges</strong>: "Compare best places to buy SOMI"</li>
            </ul>
            <p>Just type what you want to do in natural language!</p>
        `);
    }

    // ===== WALLET MANAGEMENT =====
    async connectWallet() {
        if (this.currentWallet) {
            this.showNotification('Info', 'Wallet already connected', 'info');
            return;
        }

        try {
            const method = await this.showConnectionMethodModal();
            
            if (method === 'privateKey') {
                await this.connectWithPrivateKey();
            } else if (method === 'mnemonic') {
                await this.connectWithMnemonic();
            }
            
            // Navigate to chat after successful connection
            this.navigateToChat();
            
        } catch (error) {
            this.showNotification('Error', 'Failed to connect wallet: ' + error.message, 'error');
        }
    }

    async connectWithPrivateKey() {
        const privateKey = prompt('Enter your private key:');
        if (!privateKey) return;

        try {
            const wallet = new ethers.Wallet(privateKey);
            const address = await wallet.getAddress();
            const connectedWallet = wallet.connect(this.provider);
            const balance = await this.provider.getBalance(address);
            const balanceInEther = ethers.utils.formatEther(balance);
            
            this.currentWallet = {
                address: address,
                privateKey: privateKey,
                wallet: connectedWallet,
                balance: balanceInEther
            };

            this.saveWalletToStorage();
            await this.updateWalletInfo();
            this.showNotification('Success', `Wallet connected! Balance: ${balanceInEther} STT`, 'success');

        } catch (error) {
            throw new Error('Invalid private key: ' + error.message);
        }
    }

    async connectWithMnemonic() {
        const mnemonic = prompt('Enter your mnemonic phrase:');
        if (!mnemonic) return;

        try {
            const wallet = ethers.Wallet.fromMnemonic(mnemonic.trim());
            const connectedWallet = wallet.connect(this.provider);
            const address = await connectedWallet.getAddress();
            const balance = await this.provider.getBalance(address);
            const balanceInEther = ethers.utils.formatEther(balance);
            
            this.currentWallet = {
                address: address,
                privateKey: wallet.privateKey,
                mnemonic: mnemonic,
                wallet: connectedWallet,
                balance: balanceInEther
            };

            this.saveWalletToStorage();
            await this.updateWalletInfo();
            this.showNotification('Success', `Wallet connected! Balance: ${balanceInEther} STT`, 'success');

        } catch (error) {
            throw new Error('Invalid mnemonic: ' + error.message);
        }
    }

    disconnectWallet() {
        this.currentWallet = null;
        this.isConnected = false;
        localStorage.removeItem('senna_wallet');
        
        // Update UI
        this.updateWalletDisplay({ address: 'Not connected', balance: '0', symbol: 'STT' });
        this.showNotification('Info', 'Wallet disconnected', 'info');
    }

    async createWallet() {
        try {
            this.showLoading();
            
            const wallet = ethers.Wallet.createRandom();
            const connectedWallet = wallet.connect(this.provider);
            const address = await connectedWallet.getAddress();
            const balance = await this.provider.getBalance(address);
            const balanceInEther = ethers.utils.formatEther(balance);
            
            const walletData = {
                address: address,
                privateKey: wallet.privateKey,
                mnemonic: wallet.mnemonic.phrase,
                balance: balanceInEther
            };

            this.currentWallet = {
                ...walletData,
                wallet: connectedWallet
            };

            this.saveWalletToStorage();
            this.showWalletModal(walletData);
            this.showNotification('Success', 'New wallet created successfully!', 'success');
            await this.updateWalletInfo();

        } catch (error) {
            this.showNotification('Error', 'Failed to create wallet: ' + error.message, 'error');
        } finally {
            this.hideLoading();
        }
    }

    async updateWalletInfo() {
        if (!this.currentWallet || !this.provider) return;

        try {
            const balance = await this.provider.getBalance(this.currentWallet.address);
            const balanceInEther = ethers.utils.formatEther(balance);
            
            const balanceData = {
                address: this.currentWallet.address,
                balance: balanceInEther,
                balance_wei: balance.toString(),
                symbol: 'STT'
            };

            this.updateWalletDisplay(balanceData);
            this.currentWallet.balance = balanceInEther;
            this.saveWalletToStorage();

        } catch (error) {
            console.error('Failed to update wallet info:', error);
        }
    }

    updateWalletDisplay(balanceData) {
        // Update header in both views
        const walletAddressElements = document.querySelectorAll('#walletAddress, #walletAddressDisplay');
        const walletBalanceElements = document.querySelectorAll('#walletBalance, #walletBalanceDisplay .balance-amount');
        
        walletAddressElements.forEach(el => {
            if (el.id === 'walletAddressDisplay') {
                el.querySelector('span').textContent = this.shortenAddress(balanceData.address);
            } else {
                el.textContent = this.shortenAddress(balanceData.address);
            }
        });
        
        walletBalanceElements.forEach(el => {
            el.textContent = parseFloat(balanceData.balance).toFixed(4);
        });

        // Update connection state
        this.isConnected = !!this.currentWallet;
        const connectBtn = document.getElementById('connectWalletBtn');
        if (connectBtn) {
            connectBtn.textContent = this.isConnected ? 'Connected' : 'Connect Wallet';
            connectBtn.disabled = this.isConnected;
        }
    }

    updateChatWalletInfo() {
        if (this.currentWallet) {
            this.updateWalletDisplay({
                address: this.currentWallet.address,
                balance: this.currentWallet.balance,
                symbol: 'STT'
            });
        }
    }

    updateLandingWalletInfo() {
        // Update landing page wallet info if needed
    }

    // ===== QUICK ACTIONS =====
    quickAction(action) {
        const actions = {
            balance: 'Show my balance',
            send: 'Send 10 STT to ',
            price: 'What is the current SOMI price?',
            help: 'What can you help me with?',
            receive: 'Show my receiving address',
            swap: 'Swap 1 STT to SOMI'
        };

        const input = document.getElementById('chatInput');
        if (!input) return;

        input.value = actions[action];
        
        if (action === 'send') {
            input.value += '0x...';
            input.focus();
            input.setSelectionRange(input.value.length - 4, input.value.length - 1);
        } else {
            this.sendMessage();
        }
    }

    // ===== TRANSACTION HANDLING =====
    showTransactionModal(transactionData) {
        const modal = document.getElementById('transactionModal');
        const details = document.getElementById('transactionDetails');
        
        if (!modal || !details) return;

        details.innerHTML = `
            <div style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px;">
                <h4>Transaction Details</h4>
                <div style="margin-top: 10px;">
                    <div><strong>From:</strong> ${this.shortenAddress(transactionData.from_address)}</div>
                    <div><strong>To:</strong> ${this.shortenAddress(transactionData.to_address)}</div>
                    <div><strong>Amount:</strong> ${transactionData.amount} ${transactionData.symbol}</div>
                    <div><strong>Network:</strong> Somnia Testnet</div>
                    <div><strong>Estimated Gas:</strong> Calculating...</div>
                </div>
            </div>
        `;

        this.estimateTransactionGas(transactionData).then(gasEstimate => {
            const gasElement = details.querySelector('div:last-child');
            if (gasElement) {
                gasElement.innerHTML = `<strong>Estimated Gas:</strong> ${gasEstimate} Gwei`;
            }
        });

        modal.classList.add('show');
    }

    async confirmTransaction() {
        const privateKeyInput = document.getElementById('privateKeyInput');
        if (!privateKeyInput) return;

        const privateKey = privateKeyInput.value.trim();
        if (!privateKey) {
            this.showNotification('Error', 'Please enter your private key', 'error');
            return;
        }

        try {
            this.showLoading();
            
            const transactionData = this.getTransactionDataFromModal();
            const wallet = new ethers.Wallet(privateKey, this.provider);
            const walletAddress = await wallet.getAddress();
            
            if (walletAddress.toLowerCase() !== this.currentWallet.address.toLowerCase()) {
                throw new Error('Private key does not match connected wallet');
            }

            const tx = {
                to: transactionData.to_address,
                value: ethers.utils.parseEther(transactionData.amount.toString()),
                gasLimit: 21000
            };

            const transaction = await wallet.sendTransaction(tx);
            
            this.hideLoading();
            this.hideModal('transactionModal');
            privateKeyInput.value = '';
            
            this.showNotification('Success', `Transaction sent! Hash: ${this.shortenAddress(transaction.hash)}`, 'success');
            this.addMessageToChat('ai', `âœ… Transaction confirmed!<br>Hash: <a href="https://shannon-explorer.somnia.network/tx/${transaction.hash}" target="_blank">${this.shortenAddress(transaction.hash)}</a>`);
            
            await transaction.wait();
            await this.updateWalletInfo();
            
        } catch (error) {
            this.hideLoading();
            this.showNotification('Error', 'Transaction failed: ' + error.message, 'error');
        }
    }

    // ===== STORAGE & UTILITIES =====
    saveChatHistory() {
        localStorage.setItem('senna_chat_history', JSON.stringify(this.chatHistory));
    }

    loadChatHistory() {
        try {
            const savedHistory = localStorage.getItem('senna_chat_history');
            if (savedHistory) {
                this.chatHistory = JSON.parse(savedHistory);
                
                // Restore chat messages
                const chatMessages = document.getElementById('chatMessages');
                if (chatMessages) {
                    chatMessages.innerHTML = '';
                    this.chatHistory.forEach(msg => {
                        this.addMessageToChat(msg.sender, msg.message, msg.data);
                    });
                }
            }
        } catch (error) {
            console.error('Failed to load chat history:', error);
        }
    }

    setupChatAutoResize() {
        const textarea = document.getElementById('chatInput');
        if (textarea) {
            textarea.addEventListener('input', () => this.resizeTextarea());
        }
    }

    resizeTextarea() {
        const textarea = document.getElementById('chatInput');
        if (textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }
    }

    // ===== ERROR HANDLING & RETRY =====
    retryInitialization() {
        this.hideErrorScreen();
        this.showLoadingScreen();
        
        setTimeout(() => {
            this.initializeProvider();
            this.hideLoadingScreen();
        }, 2000);
    }

    showLoadingScreen() {
        const loadingScreen = document.getElementById('loadingScreen');
        const contentArea = document.getElementById('contentArea');
        if (loadingScreen && contentArea) {
            loadingScreen.style.display = 'flex';
            contentArea.style.display = 'none';
        }
    }

    hideLoadingScreen() {
        const loadingScreen = document.getElementById('loadingScreen');
        const contentArea = document.getElementById('contentArea');
        if (loadingScreen && contentArea) {
            loadingScreen.style.display = 'none';
            contentArea.style.display = 'block';
        }
    }

    showErrorScreen(message) {
        const errorScreen = document.getElementById('errorScreen');
        const errorMessage = document.getElementById('errorMessage');
        const contentArea = document.getElementById('contentArea');
        
        if (errorScreen && errorMessage && contentArea) {
            errorMessage.textContent = message;
            errorScreen.style.display = 'flex';
            contentArea.style.display = 'none';
        }
    }

    hideErrorScreen() {
        const errorScreen = document.getElementById('errorScreen');
        const contentArea = document.getElementById('contentArea');
        
        if (errorScreen && contentArea) {
            errorScreen.style.display = 'none';
            contentArea.style.display = 'block';
        }
    }

    // ===== EXISTING UTILITY METHODS =====
    // ... (Include all the existing utility methods from your original code)
    // showNotification, showLoading, hideLoading, shortenAddress, 
    // apiCall, updateMarketData, setupAutoRefresh, etc.

    // These methods remain the same as in your original code:
    // showWalletModal, hideModal, copyWalletData, downloadWalletData,
    // estimateTransactionGas, getTransactionDataFromModal, 
    // showConnectionMethodModal, updateNetworkStatus,
    // loadWalletFromStorage, saveWalletToStorage, getSessionId,
    // viewOnExplorer, checkGasPrice, exportWallet
}

// Enhanced clipboard functionality
document.addEventListener('click', (e) => {
    if (e.target.classList.contains('copy-btn') || e.target.closest('.copy-btn')) {
        const btn = e.target.classList.contains('copy-btn') ? e.target : e.target.closest('.copy-btn');
        const targetId = btn.getAttribute('data-target');
        const targetElement = document.getElementById(targetId);
        
        if (targetElement) {
            navigator.clipboard.writeText(targetElement.textContent).then(() => {
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i>';
                btn.style.background = 'var(--success)';
                
                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                    btn.style.background = '';
                }, 2000);
            });
        }
    }
});

// Handle browser back/forward buttons
window.addEventListener('popstate', () => {
    if (window.sennaWallet) {
        window.sennaWallet.handleUrlRouting();
    }
});

// Initialize the application when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    window.sennaWallet = new SennaWallet();
});

// Export for global access
if (typeof module !== 'undefined' && module.exports) {
    module.exports = SennaWallet;
}